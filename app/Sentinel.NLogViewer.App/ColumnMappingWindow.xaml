<Window x:Class="Sentinel.NLogViewer.App.ColumnMappingWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Column Mapping Configuration" 
        Height="600" 
        Width="800"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize">
    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Title -->
        <TextBlock Text="Configure Column Mapping" 
                   FontSize="18" 
                   FontWeight="Bold"
                   Margin="0,0,0,15"
                   Grid.Row="0"/>

        <!-- Column Mapping Section -->
        <GroupBox Header="Column Mapping" Grid.Row="1" Margin="0,0,0,10">
            <Grid Margin="5">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <TextBlock Text="Map each detected column to a log field:" 
                           Margin="0,0,0,10"
                           Grid.Row="0"/>

                <DataGrid x:Name="ColumnsDataGrid"
                          Grid.Row="1"
                          ItemsSource="{Binding Columns}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          SelectionMode="Single"
                          HeadersVisibility="Column"
                          MinHeight="150">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Column" 
                                          Binding="{Binding Index}"
                                          IsReadOnly="True"
                                          Width="60" />
                        <DataGridTextColumn Header="Sample Data" 
                                          Binding="{Binding SampleData}"
                                          IsReadOnly="True"
                                          Width="*" />
                        <DataGridTemplateColumn Header="Map To">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <ComboBox ItemsSource="{Binding DataContext.FieldTypes, RelativeSource={RelativeSource AncestorType=Window}}"
                                            SelectedItem="{Binding MappedField, UpdateSourceTrigger=PropertyChanged}"
                                            Margin="2"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </GroupBox>

        <!-- Options Section -->
        <GroupBox Header="Options" Grid.Row="2" Margin="0,0,0,10">
            <StackPanel Margin="5">
                <CheckBox Content="First line is a header/info line" 
                          IsChecked="{Binding HasHeaderLine}"
                          Margin="0,5"/>
                <CheckBox Content="Save this mapping for files matching pattern" 
                          IsChecked="{Binding SaveForPattern}"
                          Margin="0,5"/>
                <Grid Margin="0,5,0,0" IsEnabled="{Binding SaveForPattern}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Label Content="File Pattern:" Grid.Column="0" VerticalAlignment="Center" />
                    <TextBox Grid.Column="1" 
                             Text="{Binding FilePattern, UpdateSourceTrigger=PropertyChanged}"
                             Margin="5,0,0,0" />
                </Grid>
            </StackPanel>
        </GroupBox>

        <!-- Preview Section -->
        <GroupBox Header="Preview" Grid.Row="3" Margin="0,0,0,10">
            <DataGrid ItemsSource="{Binding PreviewResults}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      IsReadOnly="True"
                      HeadersVisibility="None"
                      MinHeight="100">
                <DataGrid.Columns>
                    <DataGridTextColumn Binding="{Binding SampleData}" Width="*" />
                </DataGrid.Columns>
            </DataGrid>
        </GroupBox>

        <!-- Buttons -->
        <StackPanel Grid.Row="4" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right">
            <Button Content="OK" 
                    Command="{Binding SaveCommand}"
                    IsDefault="True"
                    Margin="0,0,5,0"
                    Padding="20,5"
                    MinWidth="80"/>
            <Button Content="Cancel" 
                    Command="{Binding CancelCommand}"
                    IsCancel="True"
                    Padding="20,5"
                    MinWidth="80"/>
        </StackPanel>
    </Grid>
</Window>

